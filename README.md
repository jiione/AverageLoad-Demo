# 🖥️ 시스템 로드 평균 이해 및 모니터링 🚀

## 1. 로드 평균 설명 📊

**로드 평균**은 특정 시간 동안 **실행 가능**(CPU를 사용 중이거나 대기 중인 프로세스) 또는 **인터럽트 불가**(I/O 대기 중인 프로세스) 상태에 있는 프로세스들의 평균 숫자를 나타냅니다.

- **1분 평균**: 지난 1분간의 로드 평균을 나타냅니다.
- **5분 평균**: 지난 5분간의 로드 평균을 나타냅니다.
- **15분 평균**: 지난 15분간의 로드 평균을 나타냅니다.

예를 들어:

```
$ uptime
02:34:03 up 2 days, 20:14, 1 user, load average: 0.63, 0.83, 0.88
```

위 명령어는 다음과 같은 정보를 보여줍니다:
- 현재 시간: **02:34:03**
- 시스템 가동 시간: **2일 20시간 14분**
- 접속 중인 사용자 수: **1명**
- 로드 평균: **0.63 (1분), 0.83 (5분), 0.88 (15분)**

---

## 2. 적절한 로드 평균이란? 🤔

**적절한 로드 평균**은 시스템의 CPU 수에 따라 달라집니다. 예를 들어, 시스템에 2개의 CPU가 있다면:
- 로드 평균이 **2**라면 CPU가 완전히 사용되고 있다는 의미입니다.
- 로드 평균이 **2**를 초과하면 CPU 과부하 상태임을 의미합니다.
- CPU 수는 다음 명령어로 확인할 수 있습니다:

```
$ grep 'model name' /proc/cpuinfo | wc -l
```

---

## 3. 로드 평균 vs. CPU 사용률 ⚡

- **로드 평균**은 실행 가능 상태 또는 인터럽트 불가 상태의 프로세스 수를 측정합니다.
- **CPU 사용률**은 CPU가 실제로 얼마나 바쁜지를 나타냅니다.

**중요한 차이점**:
- 높은 로드 평균은 CPU 사용률이 높거나, I/O 대기 시간이 길어질 수 있음을 나타냅니다.
- `mpstat`, `pidstat`, `iostat`와 같은 도구를 사용해 로드 증가 원인을 분석할 수 있습니다.

---

## 4. 로드 평균 실습 예제 🧪

### CPU-intensive 프로세스 예제 🖥️

1. `stress` 도구를 사용해 CPU-intensive형 프로세스를 실행합니다:

```
$ stress --cpu 1 --timeout 600
```

2. `uptime` 명령어로 시스템 로드를 모니터링합니다:

```
$ watch -d uptime
```

3. `mpstat`로 CPU 사용률을 분석합니다:

```
$ mpstat -P ALL 5
```

---

### I/O-intensive 프로세스 예제 💾

1. `stress` 도구를 사용해 I/O-intensive 프로세스를 실행합니다:

```
$ stress -i 1 --timeout 600
```

2. `uptime` 명령어로 시스템 로드를 모니터링합니다:

```
$ watch -d uptime
```

3. `mpstat`로 높은 I/O 대기 시간을 확인합니다:

```
$ mpstat -P ALL 5
```

4. `pidstat`로 높은 I/O 대기 시간을 유발하는 프로세스를 확인합니다:

```
$ pidstat -u 5
```

---

### 다수의 프로세스 실행 예제 (시스템 과부하 시뮬레이션) ⚙️

1. 8개의 프로세스를 실행해 시스템을 과부하 상태로 만듭니다:

```
$ stress -c 8 --timeout 600
```

2. `uptime` 명령어로 시스템 로드를 모니터링합니다:

```
$ uptime
```

3. `pidstat`로 CPU를 대기 중인 프로세스들을 확인합니다:

```
$ pidstat -u 5
```

---

## 5. 결론 📝

- **로드 평균**은 시스템 전체 성능을 빠르게 평가할 수 있는 지표입니다.
- 그러나 로드 평균만으로는 병목 지점을 찾을 수 없으므로, `mpstat`, `pidstat` 등의 도구를 사용해 원인을 분석해야 합니다.
- 로드 평균이 갑자기 상승하면 원인을 파악해 시스템이 반응하지 않기 전에 조치를 취하는 것이 중요합니다.
